<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hello World</title>
</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.7.1/pixi.min.js"></script>
    <script src="./pixi-spine.js"></script>
    <script type="text/javascript">
        //
        var time,
            speed,
            oldtime;
        oldtime = new Date().getTime();

        var file = 0;
        var data = 0;

        //

        let app = new PIXI.Application();
        let tmpTime = 0

        document
            .body
            .appendChild(app.view);

        // load spine data
        PIXI
            .loader
            .add('kings', './Sc-00/Sc_00.json')
            .load(onAssetsLoaded);

        // Enable interaction events for the DisplayObject. Touch, pointer and mouse
        // events will not be emitted unless interactive is set to true.
        app.stage.interactive = true;

        // If enabled, the mouse cursor use the pointer behavior when hovered over the
        // displayObject if it is interactive Setting this changes the 'cursor' property
        // to 'pointer'.
        app.stage.buttonMode = true;

        function onAssetsLoaded(loader, res) {
            let king = new PIXI
                .spine
                .Spine(res.kings.spineData);

            // set current skin
            king
                .skeleton
                .setSkinByName('King');

            king
                .skeleton
                .setSlotsToSetupPose();

            // set the position
            king.x = 150;
            king.y = 100;

            king
                .scale
                .set(0.2);

            app
                .stage
                .addChild(king);

            // addAnimation (int trackIndex, string animationName, bool loop, float delay)

            king
                .state
                .setAnimation(0, 'Shaking', true);

            function updata() {
                switch (file) {
                    case 0:
                        data -= 1;
                        break;
                    case 1:
                        data -= 0;
                        break;
                    case 2:
                        data += 1;
                        break;
                    case 3:
                        data += 2;
                        break;
                }
                file = 0; //更新档位
                if (data <= 0) {
                    data = 0;
                }
                if (data >= 9) {
                    data = 9;
                }
                show(); //渲染视图
            }

            var timer = setInterval(function() {
                updata(); //0.5更新一次状态
            }, 300)

            function show() { //渲染函数
                switch (data) {
                    case 0:
                        king.state.timeScale = 0.2
                        break;
                    case 2:
                        king.state.timeScale = 0.4
                        break;
                    case 3:
                        king.state.timeScale = 0.6
                        break;
                    case 4:
                        king.state.timeScale = 0.8
                        break;
                    case 5:
                        king.state.timeScale = 1
                        break;
                    case 6:
                        king.state.timeScale = 1.4
                        break;
                    case 7:
                        king.state.timeScale = 1.8

                        break;
                    case 8:
                        king.state.timeScale = 2

                        break;
                    case 9:
                        king.state.timeScale = 2.2
                        break;
                }
            }

            //

            app
                .stage
                .on('pointertap', function() {
                    time = new Date().getTime();
                    speed = time - oldtime;
                    if (speed > 500) {
                        file = 0;
                    } else if (speed > 300) {
                        file = 1;
                    } else if (speed > 1500) {
                        file = 2;
                    } else {
                        file = 3;
                    }
                    oldtime = time;
                    time = null;

                })

        };

        // }
    </script>
</body>

</html>